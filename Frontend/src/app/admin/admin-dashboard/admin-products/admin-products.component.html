<div class="page">
  <!-- Header with Debug Tools -->
  <div class="header">
    <div class="header-content">
      <div class="header-icon">‚òÄÔ∏è</div>
      <div>
        <h2>Solar Products</h2>
        <p class="header-subtitle">Manage your solar energy products inventory</p>
        <small *ngIf="products.length > 0" style="color: #666; font-size: 12px;">
          Showing {{ filteredProducts.length }} of {{ products.length }} products
        </small>
      </div>
    </div>
    <div style="display: flex; gap: 10px; align-items: center;">
      <!-- Debug buttons (temporary) -->
      <!-- <button (click)="testAPI()" class="debug-btn" title="Test API Connection">
        üîß Test API
      </button>
      <button (click)="logProductData()" class="debug-btn" title="Log Data to Console">
        üìã Log Data
      </button> -->
      <button (click)="reloadProducts()" class="debug-btn" title="Reload Products">
        üîÑ Reload
      </button>
      <a routerLink="new" class="btn">
        <span>‚ûï</span> Add Product
      </a>
    </div>
  </div>

  <!-- API Status Indicator -->
  <div *ngIf="apiStatus" class="api-status" [ngClass]="apiStatus.type">
    <span class="status-icon">{{ apiStatus.icon }}</span>
    <span class="status-text">{{ apiStatus.message }}</span>
  </div>

  <!-- Stats Grid -->
  <div *ngIf="products.length > 0" class="stats-grid">
    <div class="stat-card stat-total">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <h3>{{ products.length }}</h3>
        <p>Total Products</p>
      </div>
    </div>
    <div class="stat-card stat-wattage">
      <div class="stat-icon">‚ö°</div>
      <div class="stat-content">
        <h3>{{ getMaxWattage() }}W</h3>
        <p>Highest Wattage</p>
      </div>
    </div>
    <div class="stat-card stat-subsidy">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <h3>‚Çπ{{ getTotalSubsidy() | number }}</h3>
        <p>Total Subsidy</p>
      </div>
    </div>
    <div class="stat-card stat-value">
      <div class="stat-icon">üíµ</div>
      <div class="stat-content">
        <h3>‚Çπ{{ getTotalNetPrice() | number }}</h3>
        <p>Total Net Value</p>
      </div>
    </div>
  </div>

  <!-- Search and Controls -->
  <div class="controls">
    <div class="search-box">
      <input
        type="text"
        placeholder="Search solar products..."
        [(ngModel)]="searchTerm"
        (input)="searchProducts()"
        class="search-input"
      />
      <span class="search-icon">üîç</span>
      <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search-btn" title="Clear search">
        ‚úï
      </button>
    </div>
    <div class="filter-actions">
      <button (click)="loadProducts()" class="action-btn refresh-btn" title="Refresh products">
        üîÑ Refresh
      </button>
      <!-- <button (click)="exportProducts()" class="action-btn export-btn" title="Export products">
        üì• Export
      </button> -->
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="solar-spinner"></div>
    <p>Loading solar products...</p>
    <small>Please wait while we fetch your products</small>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && products.length === 0 && !searchTerm" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>No Products Available</h3>
    <p>No solar products found in the database.</p>
    <div class="error-actions">
      <button (click)="loadProducts()" class="btn retry-btn">
        üîÑ Retry Loading
      </button>
      <a routerLink="new" class="btn">
        ‚ûï Add First Product
      </a>
      <button (click)="testAPI()" class="btn test-api-btn">
        üîß Test API Connection
      </button>
    </div>
  </div>

  <!-- Products Table -->
  <div *ngIf="!loading && products.length > 0" class="table-container">
    <div class="table-header">
      <h3>Solar Products List</h3>
      <div class="table-stats">
        <span class="stat-item">Total: {{ products.length }}</span>
        <span class="stat-item">Showing: {{ filteredProducts.length }}</span>
        <span class="stat-item">Value: ‚Çπ{{ getTotalNetPrice() | number }}</span>
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="solar-table">
        <thead>
          <tr>
            <th>S.No</th>
            <th>Product Details</th>
            <th>Wattage</th>
            <th>Base Price</th>
            <th>Subsidy</th>
            <th>Net Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts; let i = index" class="product-row">
            <td class="serial-number">
              <span class="serial-badge">{{ i + 1 }}</span>
            </td>
            <td>
              <div class="product-info">
                <div class="product-icon" [ngClass]="getProductClass(product.type)">
                  {{ getProductIcon(product.type) }}
                </div>
                <div class="product-details">
                  <div class="product-name">{{ product.type || 'Unknown Product' }}</div>
                  <div class="product-id">
                    <small>ID: {{ product.id }}</small>
                  </div>
                  <div *ngIf="product.description" class="product-description">
                    <small>{{ product.description }}</small>
                  </div>
                </div>
              </div>
            </td>
            <td class="wattage-cell">
              <span class="wattage-badge">{{ product.watt || 0 }}W</span>
              <small *ngIf="product.efficiency" class="efficiency">
                {{ product.efficiency }}% eff.
              </small>
            </td>
            <td class="price-cell">
              <div class="price-display">
                <span class="currency">‚Çπ</span>
                <span class="price-amount">{{ product.basePrice || 0 | number:'1.0-0' }}</span>
              </div>
              <small class="price-label">Base Price</small>
            </td>
            <td class="subsidy-cell">
              <div class="subsidy-display">
                <span class="currency">‚Çπ</span>
                <span class="subsidy-amount">{{ product.subsidy || 0 | number:'1.0-0' }}</span>
              </div>
              <small class="subsidy-label">Government Subsidy</small>
              <small *ngIf="product.basePrice" class="subsidy-percentage">
                ({{ ((product.subsidy / product.basePrice) * 100) | number:'1.0-0' }}%)
              </small>
            </td>
            <td class="net-price-cell">
              <div class="net-price-display">
                <span class="currency">‚Çπ</span>
                <span class="net-price-amount">{{ calculateNetPrice(product) | number:'1.0-0' }}</span>
              </div>
              <small class="net-price-label">Final Price</small>
              <small *ngIf="product.warranty" class="warranty-badge">
                üõ°Ô∏è {{ product.warranty }}y
              </small>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <a [routerLink]="['edit', product.id]" class="action-btn edit-btn" title="Edit Product">
                  <span class="btn-icon">‚úèÔ∏è</span>
                  <span class="btn-text">Edit</span>
                </a>
                <button (click)="deleteProduct(product.id)" class="action-btn delete-btn" title="Delete Product">
                  <span class="btn-icon">üóëÔ∏è</span>
                  <span class="btn-text">Delete</span>
                </button>
                <!-- <button (click)="viewProductDetails(product.id)" class="action-btn view-btn" title="View Details">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  <span class="btn-text">View</span>
                </button> -->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Search Results Empty State -->
    <div *ngIf="filteredProducts.length === 0 && searchTerm" class="search-empty-state">
      <div class="empty-icon">üîç</div>
      <h3>No Matching Products</h3>
      <p>No products found for search term: "<strong>{{ searchTerm }}</strong>"</p>
      <button (click)="clearSearch()" class="btn">
        ‚úï Clear Search
      </button>
    </div>
  </div>

  <!-- Footer Stats -->
  <div *ngIf="!loading && products.length > 0" class="footer-stats">
    <div class="footer-stat">
      <span class="stat-label">Total Products:</span>
      <span class="stat-value">{{ products.length }}</span>
    </div>
    <div class="footer-stat">
      <span class="stat-label">Total Wattage:</span>
      <span class="stat-value">{{ getTotalWattage() }}W</span>
    </div>
    <div class="footer-stat">
      <span class="stat-label">Total Investment:</span>
      <span class="stat-value">‚Çπ{{ getTotalNetPrice() | number }}</span>
    </div>
    <div class="footer-stat">
      <span class="stat-label">Total Subsidy:</span>
      <span class="stat-value">‚Çπ{{ getTotalSubsidy() | number }}</span>
    </div>
  </div>

  <!-- Debug Info Panel (only visible in development) -->
  <div *ngIf="showDebugInfo" class="debug-panel">
    <div class="debug-header">
      <h4>Debug Information</h4>
      <button (click)="toggleDebugInfo()" class="debug-close">‚úï</button>
    </div>
    <div class="debug-content">
      <pre>{{ debugInfo | json }}</pre>
    </div>
  </div>

  <router-outlet></router-outlet>
</div>